import{m as w}from"./index.gJcamd8L.js";const b=new w("/bareworker.js");let i,o,c,m,l=0,a=0;const d=document.getElementById("address"),g=e=>{const t=new URL(e).hostname;return t?`https://favicone.com/${t}`:"/favicon.ico"};window.tabs=[];const p={epoxy:"https://unpkg.com/@mercuryworkshop/epoxy-transport@2.1.27/dist/index.mjs",libcurl:"https://unpkg.com/@mercuryworkshop/libcurl-transport@1.5.0/dist/index.mjs"},v="/ultraworker.js",E=["localhost","127.0.0.1"];async function y(){if(!navigator.serviceWorker)throw"https:"===location.protocol||E.includes(location.hostname)?new Error("Your browser doesn't support service workers."):new Error("Service workers cannot be registered without https.");await navigator.serviceWorker.register(v)}function x(e,t="https://duckduckgo.com/search?q=%s"){try{return new URL(e).toString()}catch{}try{const t=new URL(`http://${e}`);if(t.hostname.includes("."))return t.toString()}catch{}return t.replace("%s",encodeURIComponent(e))}async function u(){null!=o&&null!=i&&(console.log(`lethal.js: Setting BareMux to ${o} and Wisp to ${i}`),await b.setTransport(o,[{wisp:i}]))}async function k(e){console.log(`lethal.js: Setting transport to ${e}`),o=p[e],o||(o=e),await u()}async function S(e){console.log(`lethal.js: Setting Wisp to ${e}`),i=e,await u()}async function U(e){return e.startsWith("bromine://")?e.replace("bromine://","/"):scramjet.encodeUrl(e)}function W(e){c=e}requestIdleCallback((async()=>{const{ScramjetController:e}=window.$scramjetLoadController(),t=new e({files:{wasm:"https://cdn.jsdelivr.net/gh/Bromine-Labs/cdn@main/crasm/scramjet.wasm.wasm",all:"https://cdn.jsdelivr.net/gh/Bromine-Labs/cdn@main/crasm/scramjet.all.js",sync:"https://cdn.jsdelivr.net/gh/Bromine-Labs/cdn@main/crasm/scramjet.sync.js"},flags:{rewriterLogs:!1,scramitize:!1,cleanErrors:!0},siteFlags:{"https://worker-playground.glitch.me/.*":{serviceworkers:!0}}});t.init(),window.scramjet=t,y().then((()=>console.log("lethal.js: Service Worker registered"))).catch((e=>console.error("lethal.js: Failed to register Service Worker",e))),new h}));class h{frame;tabNumber;title="New Tab";url="bromine://newtab";timesErrored;uiElement;constructor(){c&&(l++,this.tabNumber=l,this.frame=scramjet.createFrame(),this.frame.frame.setAttribute("class","w-full h-full border-0 absolute"),this.frame.frame.setAttribute("title","Proxy Frame"),this.frame.frame.setAttribute("src","/newtab"),this.frame.frame.setAttribute("id",`frame-${l}`),c.appendChild(this.frame.frame),this.createUI(),window.tabs.push(this),this.switch(),this.frame.frame.addEventListener("load",(()=>{const e=scramjet.decodeUrl(this.frame.frame.contentWindow.location.href);this.handleLoad(e)})))}createUI(){const e=document.getElementById("tabs");if(!e)return;const t=document.createElement("div");t.className="flex items-center min-w-[8rem] max-w-xs px-4 py-1 bg-overlay light hover:bg-overlay cursor-pointer transition-all duration-150 draggable-tab",t.dataset.tabId=this.tabNumber,t.draggable=!0,t.innerHTML=`\n\t      <img class="w-4 h-4 mr-2 rounded" alt="Favicon" src="/favicon.ico" />\n\t      <span class="tab truncate flex-1 text-sm">${this.title}</span>\n\t      <button class="ml-2 text-xl focus:outline-none">&times;</button>\n\t    `,t.querySelector("button")?.addEventListener("click",(e=>{e.stopPropagation(),this.close()})),t.addEventListener("click",(()=>this.switch())),e.appendChild(t),this.uiElement=t}updateUI(){if(!this.uiElement)return;const e=this.uiElement.querySelector("img"),t=this.uiElement.querySelector(".tab");e&&(e.src=this.url?g(this.url):"/favicon.ico"),t&&(t.textContent=this.title||"New Tab"),window.tabs.forEach((e=>{if(!e.uiElement)return;const t=e.tabNumber===a;e.uiElement.classList.toggle("border-x-3",t),e.uiElement.classList.toggle("bg-overlay",t),e.uiElement.classList.toggle("active",t),e.uiElement.classList.toggle("font-medium",t),e.uiElement.classList.toggle("border-border",t)}))}switch(){a=this.tabNumber,c.querySelectorAll("iframe").forEach((e=>e.classList.add("hidden"))),this.frame.frame.classList.remove("hidden"),m=this.frame.frame,d.value=scramjet.decodeUrl(m?.contentWindow?.location.href??""),this.updateUI()}close(){this.frame.frame.remove(),this.uiElement?.remove(),window.tabs=window.tabs.filter((e=>e.tabNumber!==this.tabNumber)),a===this.tabNumber&&(window.tabs.length>0?window.tabs[0].switch():j())}handleLoad(e){if(this.tabNumber!==a)return;this.title=this.frame.frame?.contentWindow?.document.title||"New Tab",this.url=e;const t=this.frame.frame.contentDocument||this.frame.frame.contentWindow.document,r=(t.body?.textContent?.toLowerCase()||"").includes("there are no bare clients"),s=t.querySelector("#errorTitle");r?++this.timesErrored<=5&&(console.warn(`Bare client error (${this.timesErrored}/5) â†’ reloading`),this.frame.frame.contentWindow.location.reload()):s?console.warn(`Iframe error (${++this.timesErrored})`):this.timesErrored=0,this.updateUI(),d.value=e}}async function j(){new h}export{k as a,d as b,a as c,W as d,m as e,U as g,x as m,j as n,S as s};